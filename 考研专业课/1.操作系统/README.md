# 操作系统

* [内存管理](#内存管理)
* [文件管理](#文件管理)
* [输入输出管理](#输入输出管理)



## 内存管理

![内存管理](3.内存管理.png)

> 为什么要配置层次式存储器？

答：（1）设置多个存储器可以使存储器两端的硬件能并行工作；（2）采用多级存储系统，特别是 Cache 技术，这是一种减轻存储器带宽对系统性能影响的最佳结构方案；（3）在微处理机内部设置各种缓冲存储器，以减轻对存储器存取的压力，增加CPU 中寄存器的数量，也可大大缓解对存储器的压力。

> 可采用哪几种方式将程序装入内存？它们分别适用于何种场合？

答：将程序装入内存可采用的方式有：绝对装入方式、重定位装入方式、动态运行时装入方式。绝对装入方式适用于单道程序环境中，重定位装入方式和动态运行时装入方式适用于多道程序环境中。

> 何谓静态链接？静态链接时需要解决两个什么问题？

答：静态链接是指在程序运行之前，先将各自目标模块及它们所需的库函数，链接成一个完整的装入模块，以后不再拆开的链接方式。主要解决以下两个问题：将相对地址进行修改，将除第一个模块外的相对地址修改成装入模块中的相应的相对地址。

> 何谓装入时动态链接？装入时动态链接方式有何优点？

答：装入时动态链接是指将用户源程序编译后所得到的一组目标模块，在装入内存时，采用边装入边链接的一种链接方式，即在装入一个目标模块时，若发生一个外部模块调用事件，将引起装入程序去找相应的外部目标模块，把它装入内存中，并修改目标模块中的相对地址。装入时动态链接方式有以下优点：便于修改和更新、便于实现对目标模块的共享。

> 何谓运行时动态链接？运行时动态链接方式有何优点？

答：运行时动态链接是将对某些模块的链接推迟到程序执行时才进行链接，也就是，在执行过程中，当发现一个被调用模块尚未装入内存时，立即由 OS 去找到该模块并将之装入内存，把它链接到调用者模块上。优点：凡是在执行过程中未被用过的目标模块，都不会被调入内存和被链接到装入模块上，这样不仅能加快程序的装入过程，而且可节省大量的内存空间。

> 在动态分区分配方式中，应如何将各空闲分区链接成空闲分区链？

答：应在每个分区的起始地址部分，设置一些用于控制分区分配的信息，以及用于链接各分区的前向指针，在分区尾部则设置一后向指针，通过前、后向指针将所有的分区链接成一个双向链。

> 为什么要引入动态重定位？如何实现？

答：程序在运行过程中经常要在内存中移动位置，为了保证这些被移动了的程序还能正常执行，必须对程序和数据的地址加以修改，即重定位，引入重定位的目的就是为了满足程序的这种需要。要在不影响指令执行速度的同时实现地址变换，必须有硬件地址变换机构的支持，即需在系统中增设一个重定位寄存器，用它来存放程序在内存中的起始地址，程序在执行时，真正访问的内存地址是相对地址与重定位寄存器中的地址相加而形成的。

> 什么是基于顺序搜索的动态分区分配算法？它可分为哪几种？

答：为了实现动态分区式分配，将系统中的空闲分区组织成空闲分区表或空闲分区链。所谓顺序搜索，是指按表或链的组织顺序，检索表或链上记录的空闲分区，去寻找一个最符合算法的、大小能满足要求的分区。分区存储管理中常采用的分配策略有：首次适应算法、循环首次适应算法、最佳适应算法、最坏适应算法。

> 在采用首次适应算法回收内存时，可能出现哪几种情况？应怎样处理这些情况？

答：（1）回收区与插入点的前一个分区相邻接，此时可将回收区与插入点的前一分区合并，不再为回收分区分配新表项，而只修改前邻接分区的大小。（2）回收分区与插入点的后一分区相邻接，此时合并两区，然后用回收区的首址作为新空闲区的首址，大小为两者之和。（3）回收区同时与插入点的前后两个分区邻接，此时将三个分区合并，使用前邻接分区的首址，大小为三区之和，取消后邻接分区的表项。（4）回收区没有邻接空闲分区，则应为回收区单独建立一个新表项，填写回收区的首址和大小，并根据其首址，插入到空闲链中的适当位置。

> 什么是基于索引搜索的动态分区分配算法？它可分为哪几种？

答：快速适应算法、伙伴系统、哈希算法。

> 分区存储管理中常用哪些分配策略？比较它们的优缺点。

答：分区存储管理中常采用的分配策略有：首次适应算法、循环首次适应算法、最佳适应算法、最坏适应算法。（1）首次适应算法的优缺点：保留了高址部分的大空闲区，有利于后到来的大型作业的分配；低址部分不断被划分，留下许多难以利用的、小的空闲区，且每次分区分配查找时都是从低址部分开始，会增加查找时的系统开销。（2）循环首次适应算法的优缺点：使内存中的空闲分区分布得更为均匀，减少了查找时的系统开销；缺乏大的空闲分区，从而导致不能装入大型作业。（3）最佳适应算法的优缺点：每次分配给文件的都是最适合该文件大小的分区；内存中留下许多难以利用的小的空闲区。（4）最坏适应算法的优缺点：给文件分配分区后剩下的的空闲区不至于太小，产生碎片的几率最小，对中小型文件分配分区操作有利；使存储器中缺乏大的空闲区，对大型文件的分区分配不利。

> 为什么要引入对换？对换可分为哪几种类型？

答：在多道环境下，一方面，在内存中的某些进程由于某事件尚未发生而被阻塞，但它却占用了大量的内存空间，甚至有时可能出现在内存中所有进程都被阻塞而迫使 CPU 停止下来等待的情况，另一方面，却又有着许多作业在外存上等待，因无内存而不能进入内存运行的情况，显然这对系统资源是一种严重的浪费，且使系统吞吐量下降。为了解决这一问题，在操作系统中引入了对换（也称交换）技术，可以将整个进程换入、换出，也可以将进程的一部分（页、段）换入、换出，前者主要用于缓解目前系统中内存的不足，后者主要用于实现虚拟存储。

> 对文件区管理的目标和对对换空间管理的目标有何不同？

答：对文件区管理的主要目标是提高文件存储空间的利用率，然后才提高对文件的访问速度，因此，对文件区空间的管理采取离散分配方式。对对换空间管理的主要目标是提高进程换入和换出的速度，然后才是提高文件存储空间的利用率，因此，对对换区空间的管理采取连续分配方式，较少的考虑外存中的碎片问题。

> 为实现对换，系统应具备哪几方面的功能？

答：系统应具备三方面功能：对换空间管理、进程换出、进程换入。

> 在以进程为单位进行对换时，每次是否都将整个进程换出？为什么？

答：在以进程为单位进行对换时，并非每次将整个进程换出，这是因为：从结构上讲，进程是由程序段、数据段和进程控制块组成的，其中进程控制块总有部分或全部常驻内存，不被换出，而程序段和数据段可能正被若干进程共享，此时它们也不能被换出。

> 基于离散分配时所用的基本单位不同，可将离散分配分为哪几种？

答：分页存储管理方式、分段存储管理方式和段页式存储管理方式。

> 什么是页面？什么是物理块？页面的大小应如何确定？

答：页面：分页存储管理将进程的逻辑地址空间分成若干个页，并为各页加以编号。物理块：把内存的物理地址空间分成若干个块，并为各块加以编号。页面大小应选择适中，且页面大小应该是 2 的幂，通常为 1 KB — 8KB 。

> 什么是页表？页表的作用是什么？

答：页表是分页式存储管理使用的数据结构，一个进程分为多少页，它的页表就有多少行，每一行记录进程的一页和它存放的物理块的页号、块号对应关系。页表用于进行地址变换。

> 为实现分页存储管理，需要哪些硬件支持？

答：需要有页表机制、地址变换机构的硬件支持。

> 在分页系统中是如何实现地址变换的？

答：利用地址变换机构实现从逻辑地址到物理地址的变换，通过页表来实现从页号到物理块号的变换，将逻辑地址中的页号转换为内存中的物理块号。

> 较详细地说明引入分段存储管理是为了满足用户哪几方面的需要。

答：（1）方便编程。用户通常把自己的作业按照逻辑关系划分为若干段，每段都从 0 编址，并有自己名字和长度，因此，希望要访问的逻辑地址是由段名和段
内偏移量决定。（2）信息共享。在实现对程序和数据的共享时，是以信息逻辑单位为基础，分页系统中的页是存放信息的物理单位，无完整意义，不便于共享；而段是信息的逻辑单位，为了实现段的共享，希望存储管理能与用户程序分段的组织方式相适应（3）信息保护。对信息的逻辑单位进行保护，分段能更有效实现实现信息保护功能。（4）动态增长。在实际应用中，有些段特别是数据段，在使用过程中会不断增长，事先又无法确切知道增长多少，分段存储管理方式能较好解决这个问题（5）动态链接。运行时先将主程序对应的目标程序装入内存并启动运行，运行过程中又需要调用某段时，才将该段调入内存链接，所以动态链接也要求以段作为管理单位。

> 在具有快表的段页式存储管理方式中，如何实现地址变换？

答：在 CPU 给出有效地址后，由地址变换机构自动将页号 P 送入高速缓冲寄存器并将此页号与高速缓存中的所有页号比较，若找到匹配页号，表示要访问的页表项在快表中，可直接从快表读出该页对应物理块号，送到物理地址寄存器中。若快表中没有对应页表项，则再访问内存页表，找到后，把从页表项中读出物理块号送地址寄存器，同时修改快表，将此页表项存入快表，但若寄存器已满，则 OS 必须找到合适的页表项换出。

> 为什么说分段系统比分页系统更易于实现信息的共享和保护？

答：对于分页系统，每个页面是分散存储的，为了实现信息共享和保护，则页面之间需要一一对应起来，为此需要建立大量的页表项，而对于分段系统，每个段都从 0 开始编址，并采用一段连续的地址空间，这样在实现共享和保护时，只需为所要共享和保护的程序设置一个段表项，将其中的基址与内存地址一一对应起来即可。

> 分页和分段存储管理有何区别？

答：分页和分段都采用离散分配的方式，且都要通过地址映射机构来实现地址变换，这是它们的共同点。对于它们的不同点有三：第一，从功能上看，页是信息的物理单位，分页是为实现离散分配方式，以消减内存的外零头，提高内存的利用率，即满足系统管理的需要，而不是用户的需要；而段是信息的逻辑单位，它含有一组其意义相对完整的信息，目的是为了能更好地满足用户的需要。第二，页的大小固定且由系统确定，而段的长度却不固定，决定于用户所编写的程序。第三，分页的作业地址空间是一维的，而分段的作业地址空间是二维的。

> 试全面比较连续分配和离散分配方式。

答：（1）连续分配是指为一个用户程序分配一个连续的地址空间，包括单一连续分配方式和分区式分配方式，前者将内存分为系统区和用户区，系统区供操作系统使用，用户区供用户使用，是最简单的一种存储方式，但只能用于单用户单任务的操作系统中；分区式分配方式分为固定分区和动态分区，固定分区是最简单的多道程序的存储管理方式，由于每个分区的大小固定，必然会造成存储空间的浪费；动态分区是根据进程的实际需要，动态地为之分配连续的内存空间，常用三种分配算法：首次适应算法，该法容易留下许多难以利用的小空闲分区，加大查找开销；循环首次适应算法，该算法能使内存中的空闲分区分布均匀，但会致使缺少大的空闲分区；最佳适应算法，该算法也易留下许多难以利用的小空闲区。（2）离散分配方式基于将一个进程直接分散地分配到许多不相邻的分区中的思想，分为分页式存储管理、分段存储管理和段页式存储管理。分页式存储管理旨在提高内存利用率，满足系统管理的需要，分段式存储管理则旨在满足用户（程序员）的需要，在实现共享和保护方面优于分页式存储管理，而段页式存储管理则是将两者结合起来，取长补短，即具有分段系统便于实现、可共享、易于保护、可动态链接等优点，又能像分页系统那样很好的解决外部碎片的问题，以及为各个分段可离散分配内存等问题，显然是一种比较有效的存储管理方式。（3）综上可见，连续分配方式和离散分配方式各有各自的特点，应根据实际情况加以改进和利用。

> 常规存储器管理方式具有哪两大特征？它对系统性能有何影响？

答：一次性：进程必须全部装入内存，对空间浪费非常大；驻留性：在程序运行过程中，进程全部驻留在内存，暂时不用的数据无法释放。

> 什么是程序运行时的时间局限性和空间局限性？

答：（1）时间局限性：如果程序中的某条指令一旦执行，则不久的将来该指令可能再次被执行；如果某个存储单元被访问，则不久的将来该存储单元可能再次被访问。产生时间局限性的典型原因是在程序中存在着大量的循环操作。（2）空间局限性：一旦程序访问了某个存储单元，则在不久的将来，其附近的存储单元也最有可能被访问，即程序在一段时间内所访问的地址，可能集中在一定的范围内。产生空间局限性的典型原因是程序是顺序执行的。

> 虚拟存储器有哪些特征？其中最本质的特征是什么？

答：虚拟存储器有多次性、对换性、虚拟性三大特征。最本质的特征是虚拟性。

> 实现虛拟存储器需要哪些硬件支持？

答： 请求分页（段）的页（段）表机制、缺页（段）中断机构、地址变换机构。

> 实现虚拟存储器需要哪几个关键技术？

答：（1）在分页请求系统中是在分页的基础上，增加了请求调页功能和页面置换功能所形成的页式虚拟存储系统，允许只装入少数页面的程序（及数据），便启动运行。（2）在请求分段系统中是在分段系统的基础上，增加了请求调段及分段置换功能后形成的段式虚拟存储系统，允许只装入少数段（而非所有段）的用户程序和数据，即可启动运行。

> 在请求分页系统中，页表应包括哪些数据项？每项的作用是什么？

答：页表应包括：页号、物理块号、状态位 P 、访问字段 A 、修改位 M 和外存地址。其中状态位 P 指示该页是否调入内存，供程序访问时参考；访问字段 A 用于记录本页在一段时间内被访问的次数，或最近已有多长时间未被访问，提供给置换算法选择换出页面时参考；修改位 M 表示该页在调入内存后是否被修改过；外存地址用于指出该页在外存上的地址，通常是物理块号，供调入该页时使用。

> 试比较缺页中断机构与一般的中断，它们之间有何明显的区别？

答：一般中断只需要保护现场然后就直接跳到需及时处理的地方，而缺页中断除了保护现场之外，还要判断内存中是否有足够的空间存储所需的页或段，然后再把所需页调进来再使用。

> 试说明请求分页系统中的地址变换过程。

答：（1）取逻辑地址分解为页号 P 和页内偏移 w 。（2）根据页号查找页表，获得该页的描述信息。（3）若该页中断位为 1 ，产生缺页中断。（4）更新该页信息。（5）根据页块号和页内偏移 w ，计算物理地址。

> 何谓固定分配局部置换和可变分配全局置换的内存分配策咯？

答：（1）固定分配局部置换。固定分配是指，为每个进程分配一组固定数目的物理块，在进程运行期间不再改变；局部置换是指，如果进程在运行中发现缺页，则只能从分配给该进程的 n 个页面中，选出一页换出，然后再调入一页。（2）可变分配全局置换。可变分配是指，先为每个进程分配一定数目的物理块，在进程运行期间，可根据情况做适当地改变；全局置换是指，如果进程在运行中发现缺页，则将 OS 所保留的空闲物理块或者以所有进程的全部物理块为标的，选择一块换出，然后将所缺之页调入。

> 在请求分页系统中，应从何处将所需页面调入内存？

答：请求分页系统中的缺页从何处调入内存分三种情况。（1）系统拥有足够对换区空间时，可以全部从对换区调入所需页面，提高调页速度，在进程运行前将与该进程有关的文件从文件区拷贝到对换区。（2）系统缺少足够对换区空间时，不被修改的文件直接从文件区调入，当换出这些页面时，未被修改的不必换出，再调入时，仍从文件区直接调入，对于可能修改的，在换出时便调到对换区，以后需要时再从对换区调入。（3） UNIX 方式。未运行页面从文件区调入，曾经运行过但被换出页面，下次从对换区调入， UNIX 系统允许页面共享，某进程请求的页面有可能已调入内存，直接使用不再调入。

> 试说明在请求分页系统中页面的调入过程。

答：每当程序所要访问的页面未在内存时（存在位为 0 ），便向 CPU 发出一缺页中断，中断处理程序首先保留 CPU 环境，分析中断原因后，转入缺页中断处理程序；该程序通过查找页表，得到该页在外存的物理块后，如果此时内存能容纳新页，则启动磁盘 I/O ，将所缺之页调入内存，然后修改页表；如果内存已满，则需先按照某种置换算法，从内存中选出一页准备换出；如果该页未被修改过（修改位为 0 ），可不必将该页写回磁盘；但如果此页已被修改（修改位为 1 ），则必须将它写回磁盘，然后再把所缺的页调入内存，并修改页表中的相应表项，置其存在位为 1 ，并将此页表项写入快表中；在缺页调入内存后，利用修改后的页表，去形成所要访问数据的物理地址，再去访问内存数据。整个页面的调入过程对用户是透明的。

> 在请求分页系统中，常采用哪几种页面置换算法？

答：常采用的页面置换算法有：最佳置换算法、先进先出置换算法、最近最久未使用（LRU）置换算法、 Clock 置换算法、最少使用置换算法、页面缓冲算法等。

> 实现 LRU 算法所需的硬件支持是什么？

答：需要寄存器和栈等硬件支持。寄存器用于记录某进程在内存中各页的使用情况，栈用于保存当前使用的各个页面的页面号。

> 试说明改进型 Clock 置换算法的基本原理。

答：因为修改过的页面在换出时付出的开销比未被修改过的页面大，在改进型 Clock 算法中，既考虑页面的使用情况，还要增加置换代价的因素，在选择页面作为淘汰页面时，把同时满足未使用过和未被修改作为首选淘汰页面。

> 影响页面换进换出效率的若干因素是什么？

答：（1）页面置换算法：影响页面换进换出效率最重要的因素，直接影响进程在运行过程中的缺页率，影响页面换进换出的开销。（2）写回磁盘的频率：如果是采取每个页面换出时，就将它写回磁盘的策略，这意味着每换出一个页面，便需要启动一次磁盘，但如果在系统中建立了一个已修改换出页面链表，对每一个要被换出的页面（已修改），系统可暂不把它们写回磁盘，而是将它们挂在已修改换出页面链表上，仅当被换出页面数目达到一定值时，再将它们一起写回到磁盘上，这样就显著地减少了磁盘 I/O 的操作次数，或者说，减少已修改页面换出的开销。（3）读入内存的频率：在设置了已修改换出页面链表后，在该链表上就暂时有一批装有数据的页面，如果需要再次访问这些页面时就不需从外存上调入，而直接从已修改换出页面链表中获取，这样也可以减少将页面从磁盘读入内存的频率，减少页面换进的开销，或者说，只需花费很小的开销，便可使这些页面，又回到该进程的驻留集中。

> 页面缓冲算法的主要特点是什么？它是如何降低页面换进、换出的频率的？

答：主要特点：显著地降低了页面换进、换出的频率，使磁盘 I/O 的操作次数大为减少，因而减少了页面换进、换出的开销；由于换入换出的开销大幅度减小，才能使其采用一种较简单的置换策略，如先进先出（FIFO）算法，它不需要特殊硬件的支持，实现起来非常简单。在该系统中，内存分配策略上采用了可变分配和局部置换方式，为了能显著地降低了页面换进、换出的频率，在内存中设置了如下两个链表：（1）空闲页面链表：是一个空闲物理块链表，用于分配给频繁发生缺页的进程，以降低该进程的缺页率，当有一个未被修改的页要换出时，实际上并不将它换出到外存，而是把它们所在的物理块，挂在空闲链表的末尾。（2）修改页面链表：由已修改的页面所形成的链表，设置该链表的目的，是为了减少已修改页面换出的次数，降低将已修该页面写回磁盘的频率，以及降低将磁盘内容读入内存的频率。

> 在请求分页系统中，产生“抖动”的原因是什么？

答：“抖动”就是指当内存中已无空闲空间而又发生缺页中断时，需要从内存中调出一页程序或数据送碰盘的对换区中，如果算法不适当，刚被换出的页很快被访问，需重新调入，因此需再选一页调出，而此时被换出的页很快又要被访问，因而又需将它调入，如此频繁更换页面，使得系统把大部分时间用在了页面的调进换出上，而几乎不能完成任何有效的工作，称这种现象为“抖动”。产生“抖动”的原因是由于 CPU 的利用率和多道程序度的对立统一矛盾关系引起的，为了提高 CPU 利用率，可提高多道程序度，但单纯提高多道程序度又会造成缺页率的急剧上升，导致 CPU 的利用率下降，而系统的调度程序又会为了提高 CPU 利用率而继续提高多道程序度，形成恶性循环，称这时的进程是处于"抖动“状态。

> 何谓工作集？它是基于什么原理确定的？

答：工作集（或驻留集）是指在某段时间间隔内，进程要访问的页面集合，经常被使用的页面需要在工作集中，而长期不被使用的页面要从工作集中被丢弃，为了防止系统出现“抖动”现象，需要选择合适的工作集大小。工作集模型的原理是：让操作系统跟踪每个进程的工作集，并为进程分配大于其工作集的物理块，如果还有空闲物理块，则可以再调一个进程到内存以增加多道程序数，如果所有工作集之和增加以至于超过了可用物理块的总数，那么操作系统会暂停一个进程，将其页面调出并且将其物理块分配给其他进程，防止出现“抖动”现象。正确选择工作集的大小，对存储器的利用率和系统吞吐量的提嵩，都将产生重要影响。

> 当前可以利用哪几种方法来防止“抖动”？

答：（1）采取局部置换策略（2）把工作集算法融入到处理机调度中（3）利用 “L = S” 准则调节缺页率（4）选择暂停的进程。

> 试说明如何利用 “L = S” 准则来调节缺页率，以避免“抖动”的发生。

答：其中 L 是缺页之间的平均时间， S 是平均缺页服务时间，即用于置换一个页面所需的时间。利用 “L = S” 准则，对于调节缺页率是十分有效的。

> 为了实现请求分段式存储管理，应在系统中增加配置哪些硬件机构？

答：请求段表机制、缺段中断机制和地址变换机构。

> 在请求段表机制中，应设置哪些段表项？

答：存取方式、访问字段 A 、修改位 M 、存在位 P 、增补位、外存始址。

> 说明请求分段系统中的缺页中断处理过程。

答：请求分段系统中的缺页中断处理过程描述如下：（1）根据当前执行指令中的逻辑地址查页表，判断该页是否在主存储器中。（2）该页标志为 0 形成缺页中断，中断装置通过交换 PSW 让操作系统的中断处理程序占用处理器。（3）操作系统处理缺页中断处理的办法是查主存分配表，找一个空闲的主存块查页表找出该页在磁盘上位置，启动磁盘读出该页信息。（4）把从磁盘上读出的信息装入找到的主存块中。（5）当页面住处被装入主存后，应修改页表中对应的表目，填上该页所占用的主存块把标志置为 1 ，表示该页已在主存储器中。（6）由于产生缺页中断时的那条指令并没执行完，所以在把页面装入之后应重新执行被中断指令。

> 如何实现共享分段的分配和回收？

答：（1）共享段的分配：在为共享段分配内存时，对第一个请求使用该共享段的进程，由系统为该共享段分配一物理区，当又有其它进程需要调用该共享段时，无须再为该段分配内存。（2）共享段的回收：当共享此段的某进程不再需要该段时，若无其他进程使用该段，则由系统回收该共享段的物理内存，否则只是取消调用者进程在共享段表中的有关记录。

## 文件管理

![文件管理](4.文件管理.png)

> 何谓数据项、记录和文件？

答：数据项是最低级的数据组织形式，可分为基本数据项和组合数据项，基本数据项是用于描述一个对象某种属性的字符集，是数据组织中可以命名的最小逻辑数据单位，即原子数据，又称为数据元素或字段；组合数据项则由若干个基本数据项构成。记录是一组相关数据项的集合，用于描述一个对象某方面的属性。文件是指有创建者所定义的、具有文件名的一组相关信息的集合。

> 文件系统的模型可分为三层，试说明其每一层所包含的基本内容。

答：最低层为对象及其属性说明，主要包括物理文件相关功能，包括文件和目录、磁盘存储空间等对象。中间层是对对象进行操纵和管理的软件集合，是文件系统的核心部分，主要是逻辑文件相关功能，包括文件存储空间管理、文件目录管理、逻辑文件到物理文件的映射、文件读写管理及文件共享与保护等诸多功能。最高层是文件系统提供给用户的接口，分为命令接口、图形化用户接口程序接口等三种类型。

> 何谓文件的逻辑结构？何谓文件的物理结构？

答：文件的逻辑结构是指从用户的观点出发所观察到的文件组织形式，也就是用户可以直接处理的数据及其结构，它独立于物理特性，而文件的物理结构则是指文件在外存上的存储组织形式，与存储介质的存储性能有关。

> 如何提高对变长记录顺序文件的检索速度？

答：为了提高对变长记录顺序文件的检索速度，可为其建立一张索引表，以主文件中每条记录的长度及指向对应记录的指针（即该记录在逻辑地址空间的首址）作为相应每个表项的内容。由于索引表本身是一个定长记录的顺序文件，若将其按记录键排序，则可以实现对主文件的方便快速的直接存取，需要指出的是，如果文件较大，应通过建立分组多级索引以进一步提高检索效率。

> 试说明关于索引文件和索引顺序文件的检索方法。

答：对索引文件进行检索时，首先根据用户（程序）提供的关键字，并利用某种（折半查找）算法检索索引表，从中找到相应的表项，再利用该表项中给出的指向记录的指针值，去访问对应的记录。对索引顺序文件结合了索引和顺序查找，适合于巨量数据的查找，它将数据分组建立索引（以减少索引表的长度），首先利用用户（程序）提供的关键字以及某种查找方法，去检索索引表，找到该记录所在记录组中的第一条记录的表项，然后在组内进行顺序查找，由于组内的数据量不多，所以组内顺序查找开销很小。

> 对目录管理的主要要求是什么？

答：实现“按名存取”、提高对目录的检索速度、文件共享、允许文件重名。

> 采用单级目录能否满足对目录管理的主要要求？为什么？

答：采用单级目录不能完全满足对目录管理的主要要求，只能实现目录管理最基本的功能，即按名存取。由于单级目录结构采用的是在系统只配置一张目录表用来记录系统中所有文件的相关信息，因此此目录文件可能会非常大，在查找时速度慢，另外不允许用户文件有重名的现象，再者由于单级目录中要求所有用户须使用相同的名字来共享同一个文件，这样又会产生重名问题，因此不便于实现文件共享。

> 目前广泛采用的目录结构形式是哪种？它有什么优点？

答：目前广泛采用的目录结构是树型目录结构。它具有以下优点：（1）能有效提高对目录的检索速度：假定文件系统中有 N 个文件，在单级目录中，最多要检索 N 个目录项，但对于有 i 级的树型目录，在目录中每检索一个指定文件，最多可能要检索 i * √N 个目录项。（2）允许文件重名：由于在树型结构的文件系统中，是利用文件路径名来检索文件的，故允许每个用户在自己的分目录中使用与其他用户文件相同的名字。（3）便于实现文件共享：在树型目录中，用户可通过路名来共享其他用户的文件，也可将一个共享文件链接到自己的目录下，从而使文件的共享变得更为方便，其实现方式也非常简单，系统只需在用户的目录文件中增设一个目录项，填上用户赋予该共享文件的新文件名，以及该共享文件的唯一标识符即可。

> Hash 检索法有何优点？又有何局限性？

答：在 Hash 检索法中，系统利用用户提供的文件名并将它变换为文件目录的索引值，再利用该索引值到目录中去查找，这样能有效地提高目录的检索速度，但 Hash 检索法也有局限性，即对于使用了通配符的文件名，系统是无法使用 Hash 检索法检索目录的。

## 输入输出管理

![输入输出管理](5.输入输出管理.png)

> 试说明 I/O 系统的基本功能。

答：隐藏物理设备的细节、与设备的无关性、提高处理机和 I/O 设备的利用率、对 I/O 设备进行控制确保对设备的正确共享、错误处理。

> 简要说明 I/O 软件的四个层次的基本功能。

答：用户层 I/O 软件：用于实现用户与 I/O 设备交互。设备独立性软件：用于实现用户程序与设备驱动器的统一接口、设备命令、设备保护，以及设备分配与释放等。设备驱动程序：与硬件直接有关，用来具体实现系统对设备发出的操作指令，驱动 I/O 设备工作。中断处理程序：用于保存被中断进程的 CPU 环境，转入相应的中断处理程序进行处理，处理完后恢复现场，并返回到被中断的进程。

> I/O 系统接口与软件/硬件（RW / HW）接口分别是什么接口？

答： I/O 系统接口是 I/O 系统与上层系统之间的接口，向上层提供对设备进行操作的抽象 I/O 命令，以方便高层对设备的使用。软件/硬件(RW / HW)接口的上面
是中断处理程序，用于不同设备的设备驱动程序，它的下面是各种设备的控制器。

> 与设备无关性的基本含义是什么？为什么要设置该层？

答：为了提高 OS 的可适应性和可扩展性，在现代 OS 中都毫无例外地实现了设备独立性，也称设备无关性。基本含义：应用程序独立于具体使用的物理设备，为了实现设备独立性而引入了逻辑设备和物理设备两个概念，在应用程序中，使用逻辑设备名称来请求使用某类设备，而系统在实际执行时，还必须使用物理设备名称。优点：设备分配时的灵活性、易于实现 I/O 重定向（用于 I/O 操作的设备可以更换，即重定向），而不必改变应用程序。

> 试说明设备控制器的组成。

答：设备控制器与处理机的接口、设备控制器与设备的接口、 I/O 逻辑。

> 为了实现 CPU 与设备控制器间的通信，设备控制器应具备哪些功能？

答：基本功能：接收和识别命令、数据交换、标识和报告设备的状态、地址识别、数据缓冲、差错控制。

> 为什么说中断是 OS 赖以生存的基础？

答：中断在操作系统中有着特殊重要的地位，它是多道程序得以实现的基础，没有中断，就不可能实现多道程序，因为进程之间的切换是通过中断来完成的；另一方面，中断也是设备管理的基础，为了提高处理机的利用率和实现 CPU 和 I/O 设备并行，也必需有中断的支持。

> 对多中断源的两种处理方式分别用于何种场合？

答：（1）屏蔽（禁止）中断：当处理机正在处理一个中断时，将屏蔽掉所有的中断，直到处理机已处理完本次中断，再去检查是否有中断产生，所有中断按顺序处理，优点是简单，但不能用于实时性要求较高的中断请求。（2）嵌套中断：在设置了中断优先级的系统中，当同时有多个不同优先级的中断请求， CPU 优先响应优先级最高的中断请求，高优先级的中断请求可以抢占正在运行的低优先级中断的处理机。

> 设备中断处理程序通常需完成哪些工作？

答：（1）唤醒被阻塞的驱动进程。（2）保护被中断进程的 CPU 环境。（3）转入相应的设备处理程序。（4）中断处理。（5）恢复被中断进程的现场。

> 简要说明中断处理程序对中断进行处理的几个步骤。

答：（1）测定是否有未响应的中断信号。（2）保护被中断进程的 CPU 环境。（3）转入相应的设备处理程序。（4）中断处理。（5）恢复 CPU 的现场并退出中断.

> 设备驱动程序通常要完成哪些工作？

答：（1）将接收到的抽象要求转为具体要求。（2）检查用户 I/O 请求合法性，了解 I/O 设备状态，传递有关参数，设置设备工作方式。（3）发出 I/O 命令，启动分配到的 I/O 设备，完成指定 I/O 操作。（4）及时响应由控制器或通道发来的中断请求，根据中断类型调用相应中断处理程序处理。（5）对于有通道的计算机，驱动程序还应该根据用户 I/O 请求自动构成通道程序。

> 简要说明设备驱动程序的处理过程可分为哪几步。

答：（1）将抽象要求转换为具体要求。（2）对服务请求进行校验。（3）检查设备的状态。（4）传送必要的参数。

> 试说明推动 I/O 控制发展的主要因素是什么。

答：促使 I/O 控制不断发展的几个主要因素如下：（1）尽量减少CPU 对 I/O 控制的干预，把 CPU 从繁杂的 I/O 控制中解脱出来，以使更多地去完成数据处理任务。（2）缓和 CPU 的高速性和设备的低速性之间速度不匹配的矛盾，以提高 CPU 的利用率和系统的吞吐量。（3）提高 CPU 和 I/O 设备操作的并行程度，使 CPU 和 I/O 设备都处于忙状态，从而提高整个系统的资源利用率和系统吞吐量。

> 有哪几种 I/O 控制方式？各适用于何种场合？

答： I/O 控制方式：程序 I/O 方式、中断驱动 I/O 控制方式、 DMA I/O 控制方式、 I/O 通道控制方式。程序 I/O 方式适用于早期的计算机系统中，并且是无中断的计算机系统；中断驱动 I/O 控制方式是普遍用于现代的计算机系统中； DMA I/O 控制方式适用于 I/O 设备为块设备时在和主机进行数据交换的一种 I/O 控制方式；当 I/O 设备和主机进行数据交换是一组数据块时通常采用 I/O 通道控制方式，但此时要求系统必须配置相应的通道及通道控制器。

> 试说明 DMA 的工作流程。

答：以从磁盘读入数据为例，说明 DMA 的工作流程。当 CPU 要从碰盘读入数据块时，先向磁盘控制器发送一条读命令，该命令被送到命令寄存器 CR 中，同时还发送本次要读入数据的内存起始目标地址，送入内存地址寄存器 MAR ，本次要读数据的字节数送入数据计数器 DC ，将磁盘中的源地址直接送 DMA 控制器的 I/O 控制逻辑上，然后启动 DMA 控制器传送数据，以后 CPU 便处理其它任务，整个数据传送过程由 DMA 控制器控制。

> 为何要引入与设备的无关性？如何实现设备的独立性？

答：引入设备独立性，可使应用程序独立于具体的物理设备，使设备分配具有灵活性，另外容易实现 I/O 重定向。为了实现设备独立性，必须在设备驱动程序之上设置一层设备独立性软件，用来执行所有 I/O 设备的公用操作，并向用户层软件提供统一接口。关键是系统中必须设置一张逻辑设备表 LUT 用来进行逻辑设备到物理设备的映射，其中每个表目中包含了逻辑设备名、物理设备名和设备驱动程序入口地址三项，当应用程序用逻辑设备名请求分配 I/O 设备时，系统必须为它分配相应的物理设备，并在 LUT 中建立一个表目，以后进程利用该逻辑设备名请求 I/O 操作时，便可从 LUT 中得到物理设备名和驱动程序入口地址。

> 与设备的无关的软件中，包括了哪些公有操作的软件？

答：（1）设备驱动程序的统一接口；（2）缓冲管理；（3）差错控制；（4）对独立设备的分配与回收；（5）独立于设备的逻辑数据块。

> 在考虑到设备的独立性时，应如何分配独占设备？

答：（1）进程以逻辑设备名提出 I/O 请求。（2）根据逻辑设备表相应表项获得 I/O 请求的逻辑设备对应类型的物理设备在系统设备表中的指针。（3）从指针所指位置起顺序检索系统设备表，直到找到一个属于对应 I/O 请求所用类型、空闲可用且基于设备分配安全性算法验证为安全分配的设备的设备控制表，将对应设备分配给请求进程，如果未找到安全可用的空闲设备，则把请求进程的进程控制块挂到相应类型设备的等待队列上等待唤醒和分配。（4）系统把设备分配给 I/O 请求进程后，再到该设备的设备控制表中找出与其相连接的控制器的控制器控制表，根据其状态字段判断该控制器是否忙碌，若忙则把请求进程的进程控制块挂到该控制器的等待队列上，否则将该控制器分配给进程。（5）系统把控制器分配给 I/O 请求进程后，再到该控制器的控制器控制表中找出与其相连接的通道的通道控制表，根据其状态字段判断该通道是否忙碌，若忙则把请求进程的进程控制块挂到该通道的等待队列上，否则将该通道分配给进程。（6）只有在设备、控制器和通道三者都分配成功时，这次的设备分配才算成功，然后便可启动设备进行数据传送。

> 何谓设备虚拟？实现设备虛拟时所依赖的关键技术是什么？

答：通过虚拟技术可将一台独占设备变换成若干台逻辑设备，供若干个用户（进程）同时使用，通常把这种经过虚拟技术处理后的设备称为虚拟设备，其实现所依赖的关键技术是 SPOOLING 技术。

> 在实现后台打印时， SPOOLing 系统应为请求 I/O 的进程提供哪些服务？

答：（1）由输出进程在输出井中为之申请一空闲盘块区，并将要打印的数据送入其中。（2）输出进程再为用户进程申请一张空白的用户打印表，并将用户的打印要求填入其中，再将该表挂到请求打印队列上。（3）一旦打印机空闲，输出进程便从请求打印队列的队首取出一张请求打印表，根据表中的要求将要打印的数据从输出井传送到内存缓冲区，再由打印机进行打印。

> 假脱机系统向用户提供共享打印机的基本思想是什么？

答：对每个用户而言，系统并非即时执行其程序输出数据的真实打印操作，而只是即时将数据输出到缓冲区，这时的数据并未真正被打印，只是让用户感觉系统已为他打印，真正的打印操作是在打印机空闲且该打印任务在等待队列中已排到队首时进行的，以上过程是对用户屏蔽的，用户是不可见的。

> 引入缓冲的主要原因是什么？

答：缓和 CPU 与 I/O 设备之间速度不匹配的矛盾，减少对 CPU 的中断频率，放宽对中断响应时间的限制，解决数据粒度不匹配的问题，提高 CPU 和 I/O 设备之间的并行性。

> 在单缓冲情况下，为什么系统对一块数据的处理时间为 max(C, T) + M ？

答：在块设备输入时，假定从磁盘把一块数据输入到缓冲区的时间为 T ，操作系统将缓冲区数据传送给用户区的时间为 M ，而 CPU 对这一块数据进行计算的时间为 C ，在单缓冲情况下，由于设备的输入操作和 CPU 的处理操作可以并行，所以系统对每一整块数据的处理时间为 max(C，T) + M 。

> 为什么在双缓冲情况下，系统对一块数据的处理时间为 max(T, C) ？

答：该方式又称缓冲对换方式，在设备输入时，先将数据送入第一缓冲区，装满后便转向第二缓冲区，此时操作系统可以从第一缓冲区移出数据，并送入用户进程，接着由 CPU 对数据进行计算。在双缓冲区中，不仅设备的输入操作和 CPU 的处理操作可以并行，设备的输入操作和数据的传送操作也可以并行，因此耗时大约为 max(C + M, T) ，考虑到 M 是内存中数据块的“搬家”耗时，非常短暂可以省略，因此近似地认为是 max(C, T) 。

> 何谓安全分配方式和不安全分配方式？

答：安全分配方式是指每当进程发出 I/O 请求后，便进入阻塞状态，直到其 I/O 操作完成时才被唤醒，在采用这种分配策略时，一旦进程已获得某种设备资源后便阻塞，使它不可能再请求任何资源，而在它运行时又不保持任何资源，这种分配方式已经摒弃了造成死锁的“请求和保持”条件，分配是安全的，缺点是进程进展缓慢， CPU 与 I/O 设备串行工作。不安全分配方式是指进程发出 I/O 请求后仍继续执行，需要时又可发出第二个 I/O 请求、第三个 I/O 请求，仅当进程请求的设备已被另一个进程占有时，进程才进入阻塞状态，优点是一个进程可同时操作多个设备，进程推进迅速，缺点是分配不安全，可能具有“请求和保持”条件，可能造成死锁。因此，在设备分配程序中需增加一个功能，用于对本次的设备分配是否会发生死锁进行安全性计算，仅当计算结果表明分配安全的情况下才进行分配。

> 磁盘访问时间由哪几部分组成？每部分时间应如何计算？

答：磁盘访问时间由寻道时间、旋转延迟时间、传输时间三部分组成。寻道时间是启动磁臂时间与磁头移动 n 条磁道的时间和，旋转延迟时间是指定扇区移动到磁头下面所经历的时间，传输时间是指数据从磁盘读出或向磁盘写入经历的时间。

> 目前常用的磁盘调度算法有哪几种？每种算法优先考怎的问题是什么？

答：目前常用的磁盘调度算法有先来先服务、最短寻道时间优先及扫描等算法。先来先服务算法优先考虑进程请求访问磁盘的先后次序；最短寻道时间优先算法优先考虑要求访问的磁道与当前磁头所在磁道距离是否最近；扫描算法考虑欲访问的磁道与当前磁道间的距离，但更优先考虑磁头当前的移动方向。
